<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì „ì—¬í–‰ ê°€ì´ë“œ (Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body { font-family: "Pretendard Variable", Pretendard, -apple-system, sans-serif; }
        /* ë¶€ë“œëŸ¬ìš´ í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .page-enter { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .hidden { display: none !important; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #10b981; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .chat-scroll::-webkit-scrollbar { width: 4px; }
        .chat-scroll::-webkit-scrollbar-thumb { background-color: #d1d5db; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2 cursor-pointer" onclick="location.hash=''">
                    <div class="bg-emerald-600 text-white p-1.5 rounded-lg shadow-md"><i data-lucide="map-pin"></i></div>
                    <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-600 to-teal-500">ëŒ€ì „ì—¬í–‰ ê°€ì´ë“œ</span>
                </div>
                <div class="flex items-center gap-3">
                    <button id="auth-btn" onclick="toggleAuth()" class="flex items-center text-xs font-bold px-3 py-1.5 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
                        <i data-lucide="user" class="w-3.5 h-3.5 mr-1"></i> ê´€ë¦¬ì
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ================= [1] ë©”ì¸ ë ˆì´ì•„ì›ƒ ================= -->
    <div id="home-view" class="max-w-7xl mx-auto px-4 py-8 page-enter">
        <div class="flex flex-col lg:flex-row gap-8 items-start">
            
            <!-- [ì¢Œì¸¡ ì‚¬ì´ë“œë°”] -->
            <aside class="w-full lg:w-80 shrink-0 space-y-6 order-2 lg:order-1">
                
                <!-- 1. ë°©ë¬¸ì í˜„í™© -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                    <h3 class="font-bold text-gray-800 mb-4 flex items-center"><i data-lucide="bar-chart-3" class="w-5 h-5 mr-2 text-emerald-600"></i> ë°©ë¬¸ì í˜„í™©</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-emerald-50 p-4 rounded-xl text-center">
                            <div class="text-xs text-emerald-600 font-bold mb-1">ì˜¤ëŠ˜ ë°©ë¬¸</div>
                            <div id="daily-count" class="text-2xl font-extrabold text-emerald-700">0</div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-xl text-center">
                            <div class="text-xs text-gray-500 font-bold mb-1">ëˆ„ì  ë°©ë¬¸</div>
                            <div id="total-count" class="text-xl font-bold text-gray-700">0</div>
                        </div>
                    </div>
                </div>

                <!-- 2. ê³µì§€ì‚¬í•­ (í´ë¦­ ì‹œ ì´ë™) -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 group cursor-pointer hover:border-emerald-300 transition-colors" onclick="location.hash='#notice'">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-gray-800 flex items-center"><i data-lucide="bell" class="w-5 h-5 mr-2 text-emerald-600"></i> ê¿€íŒ & ê³µì§€</h3>
                        <span class="text-xs text-gray-400 group-hover:text-emerald-600 flex items-center">ì „ì²´ë³´ê¸° <i data-lucide="chevron-right" class="w-3 h-3 ml-1"></i></span>
                    </div>
                    <ul id="sidebar-notice-list" class="space-y-2">
                        <li class="text-xs text-gray-400 text-center py-4">ë¡œë”© ì¤‘...</li>
                    </ul>
                </div>

                <!-- 3. ì±„íŒ…ë°© (PCìš©) -->
                <div class="hidden lg:flex flex-col bg-white rounded-2xl shadow-sm border border-gray-100 h-[400px] overflow-hidden sticky top-24">
                    <div class="bg-emerald-600 p-4 text-white font-bold flex justify-between items-center shrink-0">
                        <span class="flex items-center"><i data-lucide="message-circle" class="w-5 h-5 mr-2"></i> ì‹¤ì‹œê°„ ì—¬í–‰ í†¡</span>
                        <span class="text-[10px] bg-emerald-500 px-2 py-0.5 rounded-full">LIVE</span>
                    </div>
                    <div id="desktop-chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 text-sm chat-scroll">
                        <div class="text-center text-xs text-gray-400 py-10">ë¡œë”© ì¤‘...</div>
                    </div>
                    <form onsubmit="sendChat(event, 'desktop')" class="p-3 border-t bg-white shrink-0">
                        <div class="flex gap-2">
                            <input id="desktop-chat-input" class="flex-1 bg-gray-100 rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500" placeholder="ë©”ì‹œì§€ ì…ë ¥..." required>
                            <button type="submit" class="bg-emerald-600 text-white p-2 rounded-lg hover:bg-emerald-700"><i data-lucide="send" class="w-4 h-4"></i></button>
                        </div>
                    </form>
                </div>
            </aside>

            <!-- [ìš°ì¸¡ ë©”ì¸ ì»¨í…ì¸ ] -->
            <section class="flex-1 w-full order-1 lg:order-2">
                <!-- íˆì–´ë¡œ ë°°ë„ˆ -->
                <div class="relative bg-emerald-900 rounded-3xl overflow-hidden h-[240px] mb-8 shadow-lg group">
                    <div class="absolute inset-0 opacity-60">
                        <img id="hero-bg-img" src="https://images.unsplash.com/photo-1627960682701-7b001a140228?auto=format&fit=crop&q=80&w=1600" class="w-full h-full object-cover transition-transform duration-[20s] group-hover:scale-110">
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-black/40 to-transparent"></div>
                    <div class="relative z-10 h-full flex flex-col justify-center px-8 md:px-12 items-start text-left">
                        <div class="bg-white/20 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-0.5 rounded-md mb-3 border border-white/30">DAEJEON TRAVEL</div>
                        <h1 id="hero-main-text" class="text-3xl md:text-4xl font-extrabold text-white mb-2 leading-tight">ë…¸ì¼ë„ì‹œ íƒˆì¶œ!<br><span class="text-emerald-300">ëŒ€ì „ í•«í”Œ ê°€ì´ë“œ</span></h1>
                        <p id="hero-sub-text" class="text-emerald-100 text-sm font-light mb-6">í˜„ì§€ì¸ì´ ì§ì ‘ ì¶”ì²œí•˜ëŠ” ë§›ì§‘ & íë§ ìŠ¤íŒŸ</p>
                        <div class="flex gap-2">
                            <button id="write-btn" onclick="openWriteModal()" class="hidden bg-emerald-600 text-white text-sm font-bold py-2.5 px-5 rounded-full shadow-lg hover:bg-emerald-700 transition-all active:scale-95 flex items-center">
                                <i data-lucide="edit-3" class="w-4 h-4 mr-2"></i> ì—¬í–‰ì§€ ë“±ë¡
                            </button>
                            <button id="edit-hero-btn" onclick="openHeroEditModal()" class="hidden bg-black/50 backdrop-blur text-white text-xs px-3 py-2 rounded-full hover:bg-black/70 flex items-center border border-white/20">
                                <i data-lucide="settings" class="w-3.5 h-3.5 mr-1.5"></i> ë°°ê²½/ë¬¸êµ¬ í¸ì§‘
                            </button>
                        </div>
                    </div>
                </div>

                <!-- í•„í„° & ì •ë ¬ -->
                <div class="bg-white p-2 rounded-xl shadow-sm border border-gray-100 mb-6 flex flex-col sm:flex-row justify-between items-center gap-3 sticky top-16 z-30">
                    <div class="flex gap-1 overflow-x-auto max-w-full scrollbar-hide w-full sm:w-auto pb-1 sm:pb-0">
                        <button onclick="filterDistrict('ì „ì²´')" class="cat-btn active px-3 py-1.5 rounded-lg text-sm font-bold bg-emerald-100 text-emerald-700 transition-colors whitespace-nowrap" data-val="ì „ì²´">ì „ì²´</button>
                        <button onclick="filterDistrict('ë™êµ¬')" class="cat-btn px-3 py-1.5 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors whitespace-nowrap" data-val="ë™êµ¬">ë™êµ¬</button>
                        <button onclick="filterDistrict('ì¤‘êµ¬')" class="cat-btn px-3 py-1.5 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors whitespace-nowrap" data-val="ì¤‘êµ¬">ì¤‘êµ¬</button>
                        <button onclick="filterDistrict('ì„œêµ¬')" class="cat-btn px-3 py-1.5 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors whitespace-nowrap" data-val="ì„œêµ¬">ì„œêµ¬</button>
                        <button onclick="filterDistrict('ìœ ì„±êµ¬')" class="cat-btn px-3 py-1.5 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors whitespace-nowrap" data-val="ìœ ì„±êµ¬">ìœ ì„±êµ¬</button>
                        <button onclick="filterDistrict('ëŒ€ë•êµ¬')" class="cat-btn px-3 py-1.5 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors whitespace-nowrap" data-val="ëŒ€ë•êµ¬">ëŒ€ë•êµ¬</button>
                    </div>
                    <select onchange="sortPlaces(this.value)" class="bg-gray-50 border-0 rounded-lg px-3 py-1.5 text-sm font-medium text-gray-600 focus:ring-2 focus:ring-emerald-500 w-full sm:w-auto">
                        <option value="recent">âœ¨ ìµœì‹ ìˆœ</option>
                        <option value="rating">â­ í‰ì ìˆœ</option>
                        <option value="views">ğŸ”¥ ì¡°íšŒìˆœ</option>
                    </select>
                </div>

                <div id="loader-area" class="flex justify-center py-20"><div class="loader"></div></div>
                <div id="places-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-6 fade-in hidden"></div>

                <footer class="mt-12 text-center text-gray-400 text-xs py-6 border-t border-gray-100">
                    <p>ëŒ€ì „ì—¬í–‰ ê°€ì´ë“œ &copy; 2025</p>
                </footer>
            </section>
        </div>
    </div>

    <!-- ================= [2] ìƒì„¸ í˜ì´ì§€ (URLë¡œ ì‘ë™) ================= -->
    <div id="detail-view" class="hidden fixed inset-0 z-[60] bg-white overflow-y-auto page-enter">
        <!-- ìƒì„¸ í—¤ë” -->
        <div class="sticky top-0 z-10 bg-white/90 backdrop-blur-md border-b border-gray-200 px-4 h-14 flex items-center justify-between">
            <button onclick="history.back()" class="flex items-center text-gray-600 hover:text-emerald-600 font-bold transition-colors">
                <i data-lucide="arrow-left" class="w-5 h-5 mr-1"></i> ëª©ë¡ìœ¼ë¡œ
            </button>
            <span class="font-bold text-gray-800 text-sm truncate max-w-[200px]" id="header-title"></span>
            <div class="w-5"></div>
        </div>

        <div class="max-w-4xl mx-auto pb-20">
            <!-- ì´ë¯¸ì§€ ì˜ì—­ (ê½‰ ì°¨ê²Œ ìˆ˜ì •ë¨: object-cover) -->
            <div class="relative w-full bg-black group aspect-video md:aspect-[21/9]">
                <img id="detail-img" src="" class="w-full h-full object-cover">
                <button onclick="prevImage()" id="btn-prev" class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 hidden"><i data-lucide="chevron-left"></i></button>
                <button onclick="nextImage()" id="btn-next" class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 hidden"><i data-lucide="chevron-right"></i></button>
                <div id="img-indicator" class="absolute bottom-4 right-4 bg-black/60 text-white text-xs px-3 py-1 rounded-full font-medium">1 / 1</div>
            </div>

            <div class="px-5 py-8">
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-6 border-b border-gray-100 pb-6">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span id="detail-district" class="bg-emerald-100 text-emerald-700 text-xs px-2.5 py-1 rounded font-bold"></span>
                            <div class="flex items-center text-yellow-500 text-sm font-bold"><i data-lucide="star" class="w-4 h-4 fill-yellow-500 mr-1"></i> <span id="detail-rating"></span></div>
                        </div>
                        <h1 id="detail-title" class="text-3xl font-extrabold text-gray-900 leading-tight"></h1>
                    </div>
                    <div class="text-gray-400 text-sm flex items-center">
                        <i data-lucide="eye" class="w-4 h-4 mr-1.5"></i> <span id="detail-views"></span>ëª…ì´ ë´¤ì–´ìš”
                    </div>
                </div>
                <div class="prose prose-emerald max-w-none">
                    <p id="detail-desc" class="text-gray-700 leading-8 whitespace-pre-line text-lg"></p>
                </div>
                <div class="mt-10">
                    <h3 class="font-bold text-gray-900 mb-3 flex items-center"><i data-lucide="hash" class="w-4 h-4 mr-1 text-emerald-500"></i> ê´€ë ¨ íƒœê·¸</h3>
                    <div id="detail-tags" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= [3] ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ í˜ì´ì§€ ================= -->
    <div id="notice-board-view" class="hidden fixed inset-0 z-[60] bg-white overflow-y-auto page-enter">
        <div class="sticky top-0 z-10 bg-white/90 backdrop-blur-md border-b border-gray-200 px-4 h-14 flex items-center justify-between">
            <button onclick="history.back()" class="flex items-center text-gray-600 hover:text-emerald-600 font-bold transition-colors">
                <i data-lucide="arrow-left" class="w-5 h-5 mr-1"></i> í™ˆìœ¼ë¡œ
            </button>
            <span class="font-bold text-gray-800 text-lg">ğŸ“¢ ê¿€íŒ & ê³µì§€ì‚¬í•­</span>
            <button id="board-write-btn" onclick="openNoticeModal()" class="hidden text-emerald-600 hover:bg-emerald-50 p-2 rounded-full"><i data-lucide="plus" class="w-5 h-5"></i></button>
            <div class="w-5 md:hidden" id="board-spacer"></div>
        </div>
        <div class="max-w-3xl mx-auto px-4 py-8">
            <div class="bg-emerald-50 rounded-xl p-6 mb-8 text-center">
                <h2 class="text-2xl font-bold text-emerald-800 mb-2">ëŒ€ì „ ì—¬í–‰, ì´ê²ƒë§Œì€ ì•Œê³  ê°€ì„¸ìš”!</h2>
                <p class="text-emerald-600 text-sm">ì¶•ì œ ì¼ì •ë¶€í„° í˜„ì§€ì¸ ê¿€íŒê¹Œì§€ ëª¨ë‘ ëª¨ì•˜ìŠµë‹ˆë‹¤.</p>
            </div>
            <div id="notice-full-list" class="space-y-4">
                <div class="text-center py-20 text-gray-400">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>
    </div>

    <!-- ================= [4] ëª¨ë‹¬ë“¤ ================= -->

    <!-- ëª¨ë°”ì¼ ì±„íŒ… -->
    <div class="lg:hidden fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3">
        <div id="mobile-chat-window" class="hidden bg-white w-[320px] h-[450px] rounded-2xl shadow-2xl border border-gray-200 flex flex-col overflow-hidden animate-[slideUp_0.3s_ease-out]">
            <div class="bg-emerald-600 p-4 text-white font-bold flex justify-between items-center shrink-0">
                <span class="flex items-center"><i data-lucide="message-circle" class="w-5 h-5 mr-2"></i> ì—¬í–‰ì ìˆ˜ë‹¤ë°©</span>
                <button onclick="toggleMobileChat()" class="hover:bg-emerald-700 p-1 rounded"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="mobile-chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50 text-sm chat-scroll"></div>
            <form onsubmit="sendChat(event, 'mobile')" class="p-3 border-t bg-white shrink-0">
                <div class="flex gap-2">
                    <input id="mobile-chat-input" class="flex-1 bg-gray-100 rounded-full px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-500" placeholder="ë©”ì‹œì§€ ì…ë ¥..." required>
                    <button type="submit" class="bg-emerald-600 text-white p-2 rounded-full hover:bg-emerald-700 shadow-md"><i data-lucide="send" class="w-4 h-4"></i></button>
                </div>
            </form>
        </div>
        <button onclick="toggleMobileChat()" class="bg-emerald-600 text-white p-3.5 rounded-full shadow-xl hover:bg-emerald-700 transition-transform hover:scale-105 flex items-center justify-center ring-4 ring-emerald-50">
            <i data-lucide="message-circle" class="w-7 h-7"></i>
        </button>
    </div>

    <!-- ë¡œê·¸ì¸ -->
    <div id="login-modal" class="fixed inset-0 z-[100] hidden bg-black/60 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-xs p-8 shadow-2xl">
            <h3 class="font-bold text-xl mb-6 text-center text-gray-800">ê´€ë¦¬ì ì ‘ì†</h3>
            <input type="email" id="email" placeholder="ì•„ì´ë””(ì´ë©”ì¼)" class="w-full mb-3 p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 focus:ring-emerald-500">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full mb-6 p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 focus:ring-emerald-500">
            <button onclick="handleLogin()" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold hover:bg-emerald-700 shadow-lg mb-3">ë¡œê·¸ì¸</button>
            <button onclick="closeModal('login-modal')" class="w-full py-2 text-gray-400 text-sm hover:text-gray-600">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ê³µì§€ ë“±ë¡ -->
    <div id="notice-modal" class="fixed inset-0 z-[100] hidden bg-black/60 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-4">ê³µì§€ì‚¬í•­ ë“±ë¡</h3>
            <textarea id="notice-text" class="w-full mb-4 p-3 border rounded-lg h-32 resize-none" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (HTML íƒœê·¸ ì‚¬ìš© ê°€ëŠ¥)"></textarea>
            <button onclick="saveNotice()" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-bold">ë“±ë¡</button>
            <button onclick="closeModal('notice-modal')" class="w-full mt-2 py-2 text-gray-400 text-sm">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ê³µì§€ ìƒì„¸ ë³´ê¸° -->
    <div id="notice-detail-modal" class="fixed inset-0 z-[100] hidden bg-black/60 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-4 pb-2 border-b">
                <h3 class="font-bold text-lg text-emerald-700"><i data-lucide="bell" class="inline w-5 h-5 mr-1"></i> ì•Œë¦¼</h3>
                <button onclick="closeModal('notice-detail-modal')" class="text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button>
            </div>
            <div id="notice-detail-content" class="text-gray-700 text-sm leading-relaxed whitespace-pre-line min-h-[100px]"></div>
            <div class="mt-4 text-right text-xs text-gray-400" id="notice-detail-date"></div>
        </div>
    </div>

    <!-- ë©”ì¸í™”ë©´ í¸ì§‘ ëª¨ë‹¬ -->
    <div id="hero-edit-modal" class="fixed inset-0 z-[100] hidden bg-black/60 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl">
            <h3 class="font-bold text-lg mb-4">ë©”ì¸ í™”ë©´ ì„¤ì •</h3>
            <div class="space-y-3">
                <div>
                    <label class="text-xs font-bold text-gray-500">ë©”ì¸ ë¬¸êµ¬ (HTML í—ˆìš©)</label>
                    <input id="edit-hero-title" class="w-full p-2 border rounded bg-gray-50" placeholder="ì˜ˆ: ê¿€ì¼ë„ì‹œ ëŒ€ì „!">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ì„œë¸Œ ë¬¸êµ¬</label>
                    <input id="edit-hero-sub" class="w-full p-2 border rounded bg-gray-50" placeholder="ì˜ˆ: í˜„ì§€ì¸ ì¶”ì²œ ë§›ì§‘">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ë°°ê²½ ì´ë¯¸ì§€ URL</label>
                    <input id="edit-hero-img" class="w-full p-2 border rounded bg-gray-50" placeholder="https://...">
                </div>
                <button onclick="saveHeroConfig()" class="w-full bg-emerald-600 text-white py-3 rounded-lg font-bold mt-2">ì €ì¥í•˜ê¸°</button>
                <button onclick="closeModal('hero-edit-modal')" class="w-full py-2 text-gray-400 text-sm">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ê¸€ì“°ê¸° -->
    <div id="write-modal" class="fixed inset-0 z-[100] hidden bg-black/60 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-lg p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 id="write-modal-title" class="font-bold text-xl text-gray-900">ì—¬í–‰ê¸° ì‘ì„±</h3>
                <button onclick="closeModal('write-modal')" class="text-gray-400 hover:text-gray-600"><i data-lucide="x"></i></button>
            </div>
            <input type="hidden" id="edit-id">
            <div class="space-y-5">
                <input id="inp-name" class="w-full p-3 border rounded-xl bg-gray-50 outline-none" placeholder="ì œëª©">
                <div class="grid grid-cols-2 gap-4">
                    <select id="inp-district" class="w-full p-3 border rounded-xl bg-gray-50 outline-none"><option>ë™êµ¬</option><option>ì¤‘êµ¬</option><option>ì„œêµ¬</option><option>ìœ ì„±êµ¬</option><option>ëŒ€ë•êµ¬</option></select>
                    <input type="number" id="inp-rating" step="0.1" max="5" class="w-full p-3 border rounded-xl bg-gray-50 outline-none" placeholder="í‰ì  (4.5)">
                </div>
                <div>
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center relative">
                        <input type="file" id="inp-files" multiple accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        <div id="upload-msg" class="text-sm text-gray-500">ì‚¬ì§„ ì¶”ê°€ (í´ë¦­)</div>
                        <div id="upload-status" class="text-sm text-blue-600 hidden">ì—…ë¡œë“œ ì¤‘...</div>
                    </div>
                    <div id="preview-area" class="flex gap-2 mt-3 overflow-x-auto h-20 scrollbar-hide"></div>
                </div>
                <textarea id="inp-desc" rows="6" class="w-full p-3 border rounded-xl bg-gray-50 outline-none resize-none" placeholder="ë‚´ìš©"></textarea>
                <input id="inp-tags" class="w-full p-3 border rounded-xl bg-gray-50 outline-none" placeholder="íƒœê·¸ (#ë§›ì§‘)">
                <button onclick="savePlace()" id="save-btn" class="w-full bg-emerald-600 text-white py-3.5 rounded-xl font-bold">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        // ============================================================
        // â–¼â–¼â–¼â–¼â–¼â–¼â–¼ [í•„ìˆ˜] ë³¸ì¸ í‚¤ë¥¼ ë®ì–´ì“°ì„¸ìš”! â–¼â–¼â–¼â–¼â–¼â–¼â–¼
        const firebaseConfig = {
            apiKey: "AIzaSyC0SzZuWIl-E0L4VItN4nrHu-O1DaoZd88",
            authDomain: "project-5196212932199830884.firebaseapp.com",
            projectId: "project-5196212932199830884",
            storageBucket: "project-5196212932199830884.firebasestorage.app",
            messagingSenderId: "491579175390",
            appId: "1:491579175390:web:e18c1334c7fd6a6c0ead4f"
        };
        // ============================================================

        if (firebaseConfig.projectId === "ë³¸ì¸_PROJECT_ID") {
            alert("âš ï¸ ì˜¤ë¥˜: Firebase ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!\nindex.html íŒŒì¼ì„ ì—´ê³  'firebaseConfig' ë¶€ë¶„ì„ ë³¸ì¸ì˜ Firebase í‚¤ê°’ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.");
        }

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, doc, deleteDoc, increment, setDoc, getDoc, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        let app, auth, db, storage;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);
        } catch(e) { console.error(e); }

        let currentUser = null;
        let allPlaces = [];
        let currentFilter = "ì „ì²´";
        let currentSort = "recent";

        // ============ [ROUTER] í˜ì´ì§€ ì „í™˜ ë¡œì§ ============
        // URL Hashê°€ ë°”ë€” ë•Œë§ˆë‹¤ í™”ë©´ì„ ì „í™˜í•©ë‹ˆë‹¤.
        window.addEventListener('hashchange', handleRoute);
        window.addEventListener('load', handleRoute);

        function handleRoute() {
            const hash = location.hash;
            // ëª¨ë“  ë·° ìˆ¨ê¹€
            document.getElementById("home-view").classList.add("hidden");
            document.getElementById("detail-view").classList.add("hidden");
            document.getElementById("notice-board-view").classList.add("hidden");

            if (hash.startsWith("#detail/")) {
                const id = hash.split("/")[1];
                showDetailView(id);
            } else if (hash === "#notice") {
                showNoticeBoard();
            } else {
                // ê¸°ë³¸ í™ˆ (hashê°€ ì—†ê±°ë‚˜ ì´ìƒí•  ë•Œ)
                document.getElementById("home-view").classList.remove("hidden");
                window.scrollTo(0,0);
            }
        }

        // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜ë“¤ (history push)
        window.goHome = () => location.hash = "";
        window.goNoticeBoard = () => location.hash = "#notice";
        
        function showNoticeBoard() {
            document.getElementById("notice-board-view").classList.remove("hidden");
            window.scrollTo(0,0);
            loadFullNotices();
        }

        function showDetailView(id) {
            // ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸° (ê°„ë‹¨ ì²˜ë¦¬)
            if (allPlaces.length === 0) {
                // ì•½ê°„ì˜ ì§€ì—° í›„ ì¬ì‹œë„ (ì‹¤ì œ ì•±ì—ì„  ë¡œë”©í™”ë©´ ë³´ì—¬ì¤Œ)
                setTimeout(() => showDetailView(id), 200);
                return;
            }

            const place = allPlaces.find(p => p.id === id);
            if(!place) {
                alert("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê¸€ì…ë‹ˆë‹¤.");
                location.hash = "";
                return;
            }

            if (db) updateDoc(doc(db, "places", id), { views: increment(1) }).catch(e=>{});

            currentDetailImages = (place.images && place.images.length > 0) ? place.images : [place.image || 'https://via.placeholder.com/800?text=No+Image'];
            currentImgIdx = 0;
            updateCarousel();

            document.getElementById("detail-title").innerText = place.name;
            document.getElementById("header-title").innerText = place.name;
            document.getElementById("detail-desc").innerText = place.description;
            document.getElementById("detail-district").innerText = place.district;
            document.getElementById("detail-rating").innerText = place.rating || 0;
            document.getElementById("detail-views").innerText = (place.views || 0) + 1;
            document.getElementById("detail-tags").innerHTML = (place.tags || []).map(t => `<span class="bg-gray-100 text-gray-600 px-3 py-1.5 rounded-lg text-sm font-medium">#${t}</span>`).join('');

            document.getElementById("detail-view").classList.remove("hidden");
            window.scrollTo(0, 0);
            lucide.createIcons();
        }

        // ============ ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ============
        let currentDetailImages = [];
        let currentImgIdx = 0;
        window.updateCarousel = () => {
            const img = document.getElementById("detail-img");
            const prev = document.getElementById("btn-prev");
            const next = document.getElementById("btn-next");
            const indic = document.getElementById("img-indicator");
            img.src = currentDetailImages[currentImgIdx];
            indic.innerText = `${currentImgIdx + 1} / ${currentDetailImages.length}`;
            if(currentDetailImages.length > 1) {
                indic.classList.remove("hidden");
                if(currentImgIdx === 0) prev.classList.add("hidden"); else prev.classList.remove("hidden");
                if(currentImgIdx === currentDetailImages.length - 1) next.classList.add("hidden"); else next.classList.remove("hidden");
            } else {
                indic.classList.add("hidden"); prev.classList.add("hidden"); next.classList.add("hidden");
            }
        };
        window.nextImage = () => { if(currentImgIdx < currentDetailImages.length-1) { currentImgIdx++; updateCarousel(); }};
        window.prevImage = () => { if(currentImgIdx > 0) { currentImgIdx--; updateCarousel(); }};

        // ============ ë°ì´í„° ë¡œë“œ & ë Œë”ë§ ============
        if (db) {
            onSnapshot(collection(db, "places"), (snapshot) => {
                allPlaces = [];
                snapshot.forEach(doc => allPlaces.push({ id: doc.id, ...doc.data() }));
                document.getElementById("loader-area").classList.add("hidden");
                document.getElementById("places-grid").classList.remove("hidden");
                renderPlaces();
                
                // ë§Œì•½ í˜„ì¬ ìƒì„¸í˜ì´ì§€ URLì— ìˆë‹¤ë©´ ë‚´ìš© ê°±ì‹  (ìƒˆë¡œê³ ì¹¨ ëŒ€ì‘)
                if(location.hash.startsWith("#detail/")) {
                    handleRoute(); 
                }
            });

            onSnapshot(doc(db, "config", "hero"), (doc) => {
                if(doc.exists()) {
                    const d = doc.data();
                    if(d.title) document.getElementById("hero-main-text").innerHTML = d.title;
                    if(d.subtitle) document.getElementById("hero-sub-text").innerText = d.subtitle;
                    if(d.image) document.getElementById("hero-bg-img").src = d.image;
                }
            });
        }

        window.renderPlaces = () => {
            const grid = document.getElementById("places-grid");
            grid.innerHTML = "";
            let filtered = currentFilter === "ì „ì²´" ? allPlaces : allPlaces.filter(p => p.district === currentFilter);
            filtered.sort((a, b) => {
                if(currentSort === 'rating') return (b.rating||0) - (a.rating||0);
                if(currentSort === 'views') return (b.views||0) - (a.views||0);
                return (b.createdAt||0) - (a.createdAt||0);
            });
            filtered.forEach(place => {
                const isAdmin = !!currentUser;
                const thumb = (place.images && place.images.length > 0) ? place.images[0] : (place.image || 'https://via.placeholder.com/400?text=No+Image');
                const card = document.createElement("div");
                card.className = "group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all border border-gray-100 overflow-hidden flex flex-col h-full cursor-pointer relative";
                
                // í´ë¦­ ì‹œ URL í•´ì‹œ ë³€ê²½ -> ë¼ìš°í„°ê°€ í˜ì´ì§€ ì´ë™ ì²˜ë¦¬
                card.onclick = (e) => { 
                    if(e.target.closest('.admin-btn')) return; 
                    location.hash = "#detail/" + place.id;
                };

                let adminHtml = isAdmin ? `<div class="absolute top-2 right-2 z-20 flex gap-1"><button onclick="editPlace('${place.id}')" class="admin-btn bg-white/90 p-2 rounded-full text-blue-600 hover:bg-blue-100 shadow-sm"><i data-lucide="edit-2" class="w-3 h-3"></i></button><button onclick="deletePlace('${place.id}')" class="admin-btn bg-white/90 p-2 rounded-full text-red-600 hover:bg-red-100 shadow-sm"><i data-lucide="trash-2" class="w-3 h-3"></i></button></div>` : "";
                card.innerHTML = `<div class="relative h-48 overflow-hidden bg-gray-100"><img src="${thumb}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"><div class="absolute top-3 left-3 bg-white/90 backdrop-blur px-2 py-1 rounded-md text-[10px] font-bold text-emerald-600 shadow-sm z-10">${place.district}</div>${adminHtml}</div><div class="p-5 flex flex-col flex-1"><div class="flex justify-between items-start mb-2"><h3 class="text-lg font-bold text-gray-800 group-hover:text-emerald-600 transition-colors line-clamp-1">${place.name}</h3><div class="flex items-center text-yellow-500 text-xs font-bold bg-yellow-50 px-1.5 py-0.5 rounded ml-2 shrink-0"><i data-lucide="star" class="w-3 h-3 fill-yellow-500 mr-1"></i> ${place.rating || 0}</div></div><p class="text-gray-500 text-sm mb-4 line-clamp-2 leading-relaxed">${place.description}</p><div class="mt-auto flex items-center justify-between"><div class="flex gap-1 flex-wrap">${(place.tags || []).slice(0, 3).map(t => `<span class="bg-gray-100 text-gray-500 text-[10px] px-2 py-1 rounded-md">#${t}</span>`).join('')}</div><div class="text-gray-400 text-xs flex items-center"><i data-lucide="eye" class="w-3 h-3 mr-1"></i> ${place.views || 0}</div></div></div>`;
                grid.appendChild(card);
            });
            lucide.createIcons();
        };

        window.filterDistrict = (d) => { currentFilter = d; updateFilterUI(); renderPlaces(); };
        window.sortPlaces = (s) => { currentSort = s; renderPlaces(); };
        function updateFilterUI() {
            document.querySelectorAll(".cat-btn").forEach(btn => {
                if(btn.dataset.val === currentFilter) btn.className = "cat-btn active px-3 py-1.5 rounded-lg text-sm font-bold bg-emerald-100 text-emerald-700 transition-colors whitespace-nowrap";
                else btn.className = "cat-btn px-3 py-1.5 rounded-lg text-sm font-medium text-gray-500 hover:bg-gray-50 transition-colors whitespace-nowrap";
            });
        }

        if (auth) {
            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                const authBtn = document.getElementById("auth-btn");
                const writeBtn = document.getElementById("write-btn");
                const noticeBtn = document.getElementById("add-notice-btn");
                const boardWriteBtn = document.getElementById("board-write-btn");
                const editHeroBtn = document.getElementById("edit-hero-btn");
                
                if(user) {
                    authBtn.innerHTML = `<i data-lucide="log-out" class="w-3.5 h-3.5 mr-1"></i> ë¡œê·¸ì•„ì›ƒ`;
                    authBtn.onclick = async () => { if(confirm("ë¡œê·¸ì•„ì›ƒ?")) await signOut(auth); };
                    writeBtn.classList.remove("hidden");
                    noticeBtn.classList.remove("hidden");
                    boardWriteBtn.classList.remove("hidden");
                    editHeroBtn.classList.remove("hidden");
                } else {
                    authBtn.innerHTML = `<i data-lucide="user" class="w-3.5 h-3.5 mr-1"></i> ê´€ë¦¬ì`;
                    authBtn.onclick = toggleAuth;
                    writeBtn.classList.add("hidden");
                    noticeBtn.classList.add("hidden");
                    boardWriteBtn.classList.add("hidden");
                    editHeroBtn.classList.add("hidden");
                }
                renderPlaces();
            });
        }

        window.openHeroEditModal = () => {
            const title = document.getElementById("hero-main-text").innerHTML;
            const sub = document.getElementById("hero-sub-text").innerText;
            const img = document.getElementById("hero-bg-img").src;
            document.getElementById("edit-hero-title").value = title;
            document.getElementById("edit-hero-sub").value = sub;
            document.getElementById("edit-hero-img").value = img;
            document.getElementById("hero-edit-modal").classList.remove("hidden");
        };
        window.saveHeroConfig = async () => {
            const title = document.getElementById("edit-hero-title").value;
            const sub = document.getElementById("edit-hero-sub").value;
            const image = document.getElementById("edit-hero-img").value;
            try {
                await setDoc(doc(db, "config", "hero"), { title, subtitle: sub, image }, { merge: true });
                closeModal("hero-edit-modal");
                alert("ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!");
            } catch(e) { alert("ì €ì¥ ì‹¤íŒ¨"); }
        };

        // ì±„íŒ…
        let chatUnsub;
        function initChatListener() {
            if (!db) return;
            const q = query(collection(db, "chat"), orderBy("createdAt", "asc"), limit(50));
            chatUnsub = onSnapshot(q, (snap) => {
                const boxes = [document.getElementById("desktop-chat-messages"), document.getElementById("mobile-chat-messages")];
                const htmlContent = [];
                snap.forEach(doc => {
                    const d = doc.data();
                    const isAdm = d.uid === 'admin';
                    const time = new Date(d.createdAt).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
                    htmlContent.push(`<div class="flex flex-col ${isAdm?'items-start':'items-end'}"><div class="${isAdm?'bg-emerald-100 text-emerald-900':'bg-gray-100 text-gray-800'} px-3 py-1.5 rounded-lg text-sm max-w-[85%]">${d.text}</div><span class="text-[9px] text-gray-400 mt-0.5">${time}</span></div>`);
                });
                boxes.forEach(box => { if(box) { box.innerHTML = htmlContent.join(''); box.scrollTop = box.scrollHeight; }});
            });
        }
        initChatListener();
        window.toggleMobileChat = () => {
            const w = document.getElementById("mobile-chat-window");
            w.classList.toggle("hidden");
            if(!w.classList.contains("hidden")) setTimeout(() => document.getElementById("mobile-chat-messages").scrollTop = 9999, 100);
        };
        window.sendChat = async(e, mode) => {
            e.preventDefault();
            const inp = document.getElementById(mode === 'desktop' ? "desktop-chat-input" : "mobile-chat-input");
            if(inp.value.trim() && db) {
                await addDoc(collection(db, "chat"), { text: inp.value, createdAt: Date.now(), uid: currentUser?'admin':'anon' });
                inp.value = "";
            }
        };

        if (db) {
            const todayKey = new Date().toISOString().slice(0, 10);
            onSnapshot(doc(db, "stats", "global"), (doc) => {
                if(doc.exists()) {
                    document.getElementById("total-count").innerText = (doc.data().total||0).toLocaleString();
                    document.getElementById("daily-count").innerText = (doc.data()[todayKey]||0).toLocaleString();
                }
            });
            if(!sessionStorage.getItem("visited")) {
                setDoc(doc(db, "stats", "global"), { total: increment(1), [todayKey]: increment(1) }, { merge: true });
                sessionStorage.setItem("visited", "true");
            }
            onSnapshot(query(collection(db, "notices"), orderBy("createdAt", "desc"), limit(5)), (snap) => {
                const list = document.getElementById("sidebar-notice-list");
                if(!snap.empty) {
                    list.innerHTML = "";
                    snap.forEach(doc => {
                        const n = doc.data();
                        const date = new Date(n.createdAt).toLocaleDateString();
                        const shortText = n.text.length > 15 ? n.text.substring(0, 15) + "..." : n.text;
                        const safeText = n.text.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        const li = document.createElement("li");
                        li.className = "flex justify-between items-center text-sm border-b border-gray-50 pb-2 cursor-pointer hover:bg-gray-50 rounded px-1 transition-colors";
                        li.onclick = (e) => { e.stopPropagation(); openNoticeDetail(safeText, date); };
                        li.innerHTML = `<span class="text-gray-700 truncate w-40">${shortText}</span><span class="text-xs text-gray-400 shrink-0">${date}</span>`;
                        list.appendChild(li);
                    });
                } else {
                    list.innerHTML = '<li class="text-xs text-gray-400 text-center py-4">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                }
            });
        }

        window.loadFullNotices = () => {
            if(!db) return;
            onSnapshot(query(collection(db, "notices"), orderBy("createdAt", "desc")), (snap) => {
                const list = document.getElementById("notice-full-list");
                if(!snap.empty) {
                    list.innerHTML = "";
                    snap.forEach(doc => {
                        const n = doc.data();
                        const date = new Date(n.createdAt).toLocaleDateString();
                        const safeText = n.text.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                        list.innerHTML += `
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow cursor-pointer" onclick="openNoticeDetail('${safeText}', '${date}')">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 text-lg flex items-center"><i data-lucide="megaphone" class="w-4 h-4 mr-2 text-emerald-600"></i> ê³µì§€/íŒ</h3>
                                    <span class="text-xs text-gray-400">${date}</span>
                                </div>
                                <p class="text-gray-600 line-clamp-2">${n.text}</p>
                            </div>
                        `;
                    });
                    lucide.createIcons();
                } else {
                    list.innerHTML = '<div class="text-center py-20 text-gray-400">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            });
        };

        window.openNoticeDetail = (text, date) => {
            document.getElementById("notice-detail-content").innerText = text;
            document.getElementById("notice-detail-date").innerText = date;
            document.getElementById("notice-detail-modal").classList.remove("hidden");
        };

        let upImgs = [];
        window.openWriteModal = () => { upImgs = []; document.getElementById("preview-area").innerHTML = ""; document.getElementById("write-modal").classList.remove("hidden"); };
        document.getElementById("inp-files").addEventListener("change", async(e) => {
            const files = Array.from(e.target.files);
            const status = document.getElementById("upload-status");
            if(!files.length) return;
            status.classList.remove("hidden");
            try {
                if(storage) {
                    const urls = await Promise.all(files.map(f => uploadBytesResumable(ref(storage, 'img/'+Date.now()+'_'+f.name), f).then(s => getDownloadURL(s.ref))));
                    upImgs = [...upImgs, ...urls];
                    const preview = document.getElementById("preview-area");
                    urls.forEach(u => preview.innerHTML += `<img src="${u}" class="h-16 w-16 object-cover rounded-lg border border-gray-200 shrink-0">`);
                    status.innerText = "ì™„ë£Œ!";
                }
            } catch(e) { alert("ì—…ë¡œë“œ ì‹¤íŒ¨"); }
        });
        window.savePlace = async() => {
            const id = document.getElementById("edit-id").value;
            const data = {
                name: document.getElementById("inp-name").value,
                district: document.getElementById("inp-district").value,
                rating: parseFloat(document.getElementById("inp-rating").value)||0,
                description: document.getElementById("inp-desc").value,
                tags: document.getElementById("inp-tags").value.split(",").filter(t=>t.trim()),
                images: upImgs,
                image: upImgs[0]||"",
                createdAt: Date.now()
            };
            if(!data.name) return alert("ì œëª© ì…ë ¥ í•„ìˆ˜");
            const btn = document.getElementById("save-btn");
            btn.disabled=true; btn.innerText="ì €ì¥ ì¤‘...";
            try {
                if(db) {
                    if(id) await updateDoc(doc(db, "places", id), data);
                    else { data.views=0; await addDoc(collection(db, "places"), data); }
                    closeModal("write-modal");
                }
            } catch(e) { alert("ì €ì¥ ì‹¤íŒ¨"); }
            btn.disabled=false; btn.innerText="ì €ì¥í•˜ê¸°";
        };
        window.editPlace = (id) => {
            const p = allPlaces.find(x=>x.id===id);
            if(!p) return;
            openWriteModal();
            document.getElementById("edit-id").value = p.id;
            document.getElementById("inp-name").value = p.name;
            document.getElementById("inp-district").value = p.district;
            document.getElementById("inp-rating").value = p.rating;
            document.getElementById("inp-desc").value = p.description;
            document.getElementById("inp-tags").value = p.tags.join(",");
            upImgs = p.images||[p.image];
            const preview = document.getElementById("preview-area");
            upImgs.forEach(u => { if(u) preview.innerHTML += `<img src="${u}" class="h-16 w-16 object-cover rounded-lg border border-gray-200 shrink-0">`; });
        };
        window.deletePlace = async(id) => { if(confirm("ì‚­ì œ?") && db) await deleteDoc(doc(db, "places", id)); };
        window.saveNotice = async() => {
            const t = document.getElementById("notice-text").value;
            if(t && db) { await addDoc(collection(db, "notices"), {text:t, createdAt:Date.now()}); closeModal("notice-modal"); alert("ë“±ë¡ë¨"); }
        };

        window.toggleAuth = () => document.getElementById("login-modal").classList.remove("hidden");
        window.openNoticeModal = () => document.getElementById("notice-modal").classList.remove("hidden");
        window.closeModal = (id) => document.getElementById(id).classList.add("hidden");
        window.handleLogin = async() => {
            try { if(auth) await signInWithEmailAndPassword(auth, document.getElementById("email").value, document.getElementById("password").value); closeModal("login-modal"); }
            catch(e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨"); }
        };
        window.lucide = lucide;

    </script>
</body>
</html>
